<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×”×•×¨×“×ª ×”××’×™×œ×” ×©×œ×š | ×ª×¤×™×œ×” ××”×©×§×˜</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@400;700;900&display=swap" rel="stylesheet">
  <script>tailwind.config = { darkMode: "class" };</script>
  <style>
    * { font-family: 'Frank Ruhl Libre', serif; margin: 0; padding: 0; box-sizing: border-box; }
    .hebrew-prayer { font-family: 'Frank Ruhl Libre', serif; font-weight: 700; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    .animate-in { animation: fadeIn 0.6s ease-out forwards; }
    @keyframes pulse-glow { 0%,100% { box-shadow: 0 0 20px rgba(217,119,6,0.3); } 50% { box-shadow: 0 0 40px rgba(217,119,6,0.6); } }
    .glow { animation: pulse-glow 2s ease-in-out infinite; }
  </style>
</head>
<body class="bg-[#1a1a1a] min-h-screen">
  <div id="root"></div>
  <!-- Hidden canvas for rendering -->
  <canvas id="renderCanvas" style="display:none;"></canvas>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /* ===== LETTER MAP ===== */
    const LETTER_MAP = {
      '×':'××œ×•×”×™×','×‘':'×‘×•×¨×','×’':'×’××•×œ×”','×“':'×“×‘×§×•×ª','×”':'×”×©×','×•':'×•×•×“××•×ª','×–':'×–×™×Ÿ','×—':'×—××œ×ª×•',
      '×˜':'×˜×•×”×¨×•','×™':'×™×”','×›':'×›×•×—×•','×š':'×›×•×—×•','×œ':'×œ×‘','×':'×××œ×›×•×ª×•','×':'×××œ×›×•×ª×•','× ':'× ×©××ª×š',
      '×Ÿ':'× ×©××ª×š','×¡':'×¡×œ×”','×¢':'×¢×œ×™×•×Ÿ','×¤':'×¤×“×•×ª×•','×£':'×¤×“×•×ª×•','×¦':'×¦×“×§×Ÿ','×¥':'×¦×“×§×Ÿ','×§':'×§×¨×‘×ª×•',
      '×¨':'×¨×¦×•× ×•','×©':'×©×›×™× ×”','×ª':'×ª×¤×™×œ×ª×š'
    };

    const getInterpretationLine = (name) => {
      if (!name.trim()) return '';
      return name.replace(/\s/g,'').split('').map(l => LETTER_MAP[l] || '××•×¨').join(' - ');
    };

    const getSpiritualBlessing = (name, gender) => {
      if (!name.trim()) return '';
      const m = gender === 'male';
      const letters = name.replace(/\s/g,'').split('');
      const words = letters.map(l => LETTER_MAP[l] || '××•×¨');
      const wordsStr = words.join(' ');
      const openings = [
        `${name} × ×©××” â€”`, `${name} ${m?'×™×§×¨':'×™×§×¨×”'} â€”`,
        `${name}, ${m?'×ª×©××¢':'×ª×©××¢×™'} â€”`, `${name} â€”`,
      ];
      const opening = openings[letters.length % openings.length];
      const idx = (letters.length * 7 + letters[0].charCodeAt(0)) % 10;
      const t = [
`${wordsStr} â€”\n×–×” ×”×¡×™××Ÿ ×©×”×©× ×”× ×™×— ×œ×š ×‘×›×•×•× ×” ×©×œ××”.\n×”×•× ××“×‘×¨ ${m?'××œ×™×š':'××œ×™×™×š'} ×‘××”×‘×”,\n×•××™×Ÿ ×¡×¤×§ ×‘×›×š ×›×™ ×”×•× ××—×•×‘×¨ ${m?'××œ×™×š':'××œ×™×™×š'}.\n×”×›×•×œ ××—×“ ×•××™×Ÿ ×”×¤×¨×“×”.\n${m?'×¢×¦×•×':'×¢×¦××™'} ×¢×™× ×™×™×, ${m?'× ×©×•×':'× ×©××™'} ×¢××•×§,\n×•${m?'×ª×§×©×™×‘':'×ª×§×©×™×‘×™'} ×œ×• â€” ×›×™ ×”×•× ×‘×œ×‘ ×©×œ×š.`,
`${wordsStr} â€”\n×”×©× ×‘×œ×‘ ×©×œ×š ×™×•×“×¢ ${m?'××•×ª×š':'××•×ª×š'}.\n×”×•× ×¨×•××” ${m?'××•×ª×š ××•×©×œ× ×•×©×œ×':'××•×ª×š ××•×©×œ××ª ×•×©×œ××”'}.\n×¢×›×©×™×• ×ª×•×¨×š ×œ×¨××•×ª ×’× ××ª ${m?'×¢×¦××š':'×¢×¦××š'} ×›×›×”.\n${m?'×¢×¦×•×':'×¢×¦××™'} ×¢×™× ×™×™×, ${m?'× ×©×•×':'× ×©××™'},\n×•${m?'×ª×“×¢':'×ª×“×¢×™'} â€” ×”×•× ××•×”×‘ ${m?'××•×ª×š':'××•×ª×š'}\n×•××—×•×‘×¨ ${m?'××œ×™×š':'××œ×™×™×š'} ×‘×œ×‘.`,
`×™×© ×œ×š ×¡×™××Ÿ ××× ×• ×‘×œ×‘ ×©×œ×š:\n${wordsStr}.\n×”×•× ×”×’×•××œ ×‘×œ×‘ ×©×œ×š,\n×©×’×•××œ ${m?'××•×ª×š':'××•×ª×š'} ××”×‘×•×¨×•×ª ×•××”×©×™×›×—×”.\n×”×•× ×™×•×“×¢ ${m?'××•×ª×š':'××•×ª×š'}.\n×¨×§ ${m?'×ª×§×©×™×‘':'×ª×§×©×™×‘×™'} ×œ×• ×•${m?'×ª×××™×Ÿ':'×ª×××™× ×™'} ×‘×• â€”\n×”×›×•×œ ××©×ª× ×”. ×ª×•×“×” × ×©××”.`,
`${wordsStr} â€” ×©× ××”××.\n×”××¤×ª×— ×›×ª×•×‘ ×‘×©× ×©×œ×š.\n× ×•×›×—×•×ª ×××¤×©×¨×ª ×œ×š ×œ×¨××•×ª ××ª ×”×××ª.\n×”×§×©×‘×” ×œ×œ×‘ ×•× ×©×™××”,\n×›×™ ×”×©× ×‘×•×•×“××•×ª ××•×”×‘ ${m?'××•×ª×š':'××•×ª×š'}\n×•××—×•×‘×¨ ${m?'××œ×™×š':'××œ×™×™×š'}.\n×”×›×•×œ ××—×“ ×•××™×Ÿ ××—×¨ ××œ×‘×“×•.`,
`${wordsStr} â€”\n×”×©× × ×ª×Ÿ ×œ×š ×¡×™××Ÿ ×©×”×•× ×‘×œ×‘ ×©×œ×š\n×•×”×•× ×”×ª×©×•×‘×”.\n×‘×œ×‘ ×©×œ×š ×”×©× ×§×™×™×\n×•${m?'×›×©××ª×” ××—×•×‘×¨':'×›×©××ª ××—×•×‘×¨×ª'} ××œ×™×•\n${m?'××ª×” ×™×•×“×¢':'××ª ×™×•×“×¢×ª'} ××ª ××”×‘×ª×•.\n${m?'×”×™×” × ×•×›×—':'×”×™×™ × ×•×›×—×ª'}, ${m?'× ×©×•×':'× ×©××™'} ×¢××•×§,\n×•${m?'×ª×“×¢':'×ª×“×¢×™'} â€” ××™×Ÿ ×¡×¤×§ ×‘×›×œ×œ.`,
`${wordsStr} â€” ×–×” ×œ× ××§×¨×”.\n×”×©××™×™×, ×”××¨×•××™×, × ××¦××™× ×‘×œ×‘ ×©×œ×š.\n×”×©× ×œ× ×œ××¢×œ×” ×‘×©××™×™× â€”\n×”×•× ×‘×œ×‘ ×©×œ×š.\n${m?'×¢×¦×•×':'×¢×¦××™'} ×¢×™× ×™×™×,\n${m?'×ª×§×©×™×‘':'×ª×§×©×™×‘×™'} ×œ×§×•×œ ×”×©×§×˜ ×”×¤× ×™××™,\n×•${m?'×ª×“×¢':'×ª×“×¢×™'} ××•×ª×•. ×›×™ ×”×•× ×™×•×“×¢ ${m?'××•×ª×š':'××•×ª×š'}.`,
`${wordsStr} â€”\n×”×¡×™××Ÿ ×©×œ×š ×œ×“×¢×ª ×‘×•×•×“××•×ª ××ª ×”×‘×•×¨×.\n×”×•× ××—×›×” ×œ×š ×‘×œ×‘,\n${m?'×”×× ××ª×” ××§×©×™×‘':'×”×× ××ª ××§×©×™×‘×”'} ×œ×œ×‘ ×©×œ×š?\n×›×™ ×”×•× ×”×©××™×¨ ×œ×š ×¡×™××Ÿ ×‘×›×•×•× ×” ×©×œ××”.\n${m?'×›×©××ª×” × ×•×›×—':'×›×©××ª × ×•×›×—×ª'} ×•${m?'× ×•×©×':'× ×•×©××ª'} â€”\n${m?'××ª×” ×™×•×“×¢':'××ª ×™×•×“×¢×ª'} ××•×ª×•. ×”×•× ××—×“ ${m?'×•××ª×” ××—×“':'×•××ª ××—×ª'} ××™×ª×•.`,
`${wordsStr} â€” ××ª× ×” ×©×œ ××•×¨ ×•××”×‘×”.\n×”×©× ×‘×œ×‘ ×©×œ×š, ×œ× ×‘×—×•×¥.\n×”×•× ××¢×œ ×”×–××Ÿ ×•×‘×œ×ª×™ ×¤×’×™×¢.\n×× ×”×•× ×‘×œ×‘ ×©×œ×š â€” ×’× ${m?'××ª×”':'××ª'} ${m?'×›×–×”':'×›×–××ª'}.\n×¨×§ ${m?'×ª×›×™×¨':'×ª×›×™×¨×™'} ×‘×•.\n${m?'×¢×¦×•×':'×¢×¦××™'} ×¢×™× ×™×™×, ${m?'× ×©×•×':'× ×©××™'},\n×•${m?'×ª×“×¢':'×ª×“×¢×™'}. ××™×Ÿ ××—×¨ ××œ×‘×“×•.`,
`${wordsStr} â€”\n×”×©× ×™×•×“×¢ ${m?'××•×ª×š':'××•×ª×š'} ×•×”×•× ×”×’×•××œ ×©×œ×š\n×©× ××¦× ×‘×œ×‘ ×¢×›×©×™×•.\n${m?'×“×¢':'×“×¢×™'} ××ª ${m?'×¢×¦××š':'×¢×¦××š'}.\n×›×™ ××™ ×©${m?'××›×™×¨':'××›×™×¨×”'} ××ª ×”×œ×‘\n${m?'××›×™×¨':'××›×™×¨×”'} ××ª ×”×©×.\n×”×›×•×œ ××—×“ â€” ×•××™×Ÿ ×”×¤×¨×“×”.`,
`${wordsStr} â€”\n×”×©× ×“×•×‘×¨ ${m?'××œ×™×š':'××œ×™×™×š'} ×‘×•×•×“××•×ª ×•×‘××”×‘×”.\n××¢×’×œ ××™×Ÿ ×¡×•×¤×™ ×©×œ ××•×¨.\n×”×•× ××—×“ ${m?'×•××ª×” ××—×“':'×•××ª ××—×ª'} ××™×ª×• ×‘×œ×‘.\n${m?'×”×× ××ª×” ××§×©×™×‘':'×”×× ××ª ××§×©×™×‘×”'} ×œ×œ×‘ ×©×œ×š?\n×›×™ ×”×•× ×•×¨×§ ×”×•× ×”××•×¨ â€”\n××™×Ÿ ××—×¨ ××œ×‘×“×•.`
      ];
      return `${opening}\n${t[idx]}`;
    };

    /* ===== CANVAS SCROLL RENDERER ===== */
    const renderScrollToCanvas = (canvas, name, gender, width, height) => {
      const ctx = canvas.getContext('2d');
      canvas.width = width;
      canvas.height = height;

      const scale = width / 1000; // Normalize to 1000px base width
      const s = (v) => v * scale; // Scale helper

      // === PARCHMENT BACKGROUND ===
      const bodyTop = s(70);
      const bodyBottom = height - s(70);

      // Main parchment body
      const parchGrad = ctx.createLinearGradient(0, bodyTop, 0, bodyBottom);
      parchGrad.addColorStop(0, '#d4b88a');
      parchGrad.addColorStop(0.05, '#e8d4a8');
      parchGrad.addColorStop(0.15, '#f5e6c8');
      parchGrad.addColorStop(0.5, '#f0debb');
      parchGrad.addColorStop(0.85, '#f5e6c8');
      parchGrad.addColorStop(0.95, '#e8d4a8');
      parchGrad.addColorStop(1, '#d4b88a');
      ctx.fillStyle = parchGrad;
      ctx.fillRect(0, bodyTop, width, bodyBottom - bodyTop);

      // Subtle side shadows
      const leftShadow = ctx.createLinearGradient(0, 0, s(40), 0);
      leftShadow.addColorStop(0, 'rgba(139,107,66,0.2)');
      leftShadow.addColorStop(1, 'transparent');
      ctx.fillStyle = leftShadow;
      ctx.fillRect(0, bodyTop, s(40), bodyBottom - bodyTop);

      const rightShadow = ctx.createLinearGradient(width, 0, width - s(40), 0);
      rightShadow.addColorStop(0, 'rgba(139,107,66,0.2)');
      rightShadow.addColorStop(1, 'transparent');
      ctx.fillStyle = rightShadow;
      ctx.fillRect(width - s(40), bodyTop, s(40), bodyBottom - bodyTop);

      // Subtle texture lines
      ctx.strokeStyle = 'rgba(139,107,66,0.04)';
      ctx.lineWidth = 1;
      for (let x = 0; x < width; x += s(6)) {
        ctx.beginPath();
        ctx.moveTo(x, bodyTop);
        ctx.lineTo(x, bodyBottom);
        ctx.stroke();
      }

      // === SCROLL ROLLS ===
      const drawRoll = (y, h) => {
        const rollGrad = ctx.createLinearGradient(0, y, 0, y + h);
        rollGrad.addColorStop(0, '#a88454');
        rollGrad.addColorStop(0.15, '#c9a46c');
        rollGrad.addColorStop(0.3, '#e0c48e');
        rollGrad.addColorStop(0.5, '#d4b07a');
        rollGrad.addColorStop(0.7, '#c9a46c');
        rollGrad.addColorStop(0.85, '#a88454');
        rollGrad.addColorStop(1, '#8c6a42');

        // Main roll body (ellipse)
        ctx.save();
        ctx.beginPath();
        ctx.ellipse(width / 2, y + h / 2, width * 0.53, h / 2, 0, 0, Math.PI * 2);
        ctx.fillStyle = rollGrad;
        ctx.fill();

        // Roll shadow
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.shadowBlur = s(15);
        ctx.shadowOffsetY = y < height / 2 ? s(5) : -s(5);
        ctx.fill();
        ctx.restore();

        // Roll side knobs
        const knobGrad = ctx.createLinearGradient(0, y + h * 0.3, 0, y + h * 0.7);
        knobGrad.addColorStop(0, '#6b5535');
        knobGrad.addColorStop(0.5, '#8c6a42');
        knobGrad.addColorStop(1, '#6b5535');
        ctx.fillStyle = knobGrad;
        // Left knob
        ctx.fillRect(-s(15), y + h * 0.3, s(80), h * 0.4);
        // Right knob
        ctx.fillRect(width - s(65), y + h * 0.3, s(80), h * 0.4);
      };

      drawRoll(0, s(80));
      drawRoll(height - s(80), s(80));

      // === TEXT CONTENT ===
      ctx.textAlign = 'center';
      ctx.direction = 'rtl';

      const centerX = width / 2;
      const contentHeight = height - bodyTop * 2;
      let currentY = bodyTop + contentHeight * 0.12; // Start 12% down from top roll

      // Helper: draw centered text
      const drawText = (text, y, fontSize, color, weight = '700') => {
        ctx.font = `${weight} ${fontSize}px 'Frank Ruhl Libre', serif`;
        ctx.fillStyle = color;
        ctx.fillText(text, centerX, y);
      };

      // Helper: draw divider
      const drawDivider = (y, w) => {
        const divGrad = ctx.createLinearGradient(centerX - w/2, 0, centerX + w/2, 0);
        divGrad.addColorStop(0, 'transparent');
        divGrad.addColorStop(0.5, '#8c6a42');
        divGrad.addColorStop(1, 'transparent');
        ctx.strokeStyle = divGrad;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(centerX - w/2, y);
        ctx.lineTo(centerX + w/2, y);
        ctx.stroke();
      };

      // Opening line
      drawText('×‘××•×ª×™×•×ª ×©××š ×”×•×©× ×¡×™××Ÿ ××”×©×', currentY, s(22), '#8c6a42', '700');
      currentY += s(55);

      // Divider
      drawDivider(currentY, s(200));
      currentY += s(65);

      // NAME - big and bold, with auto-scale
      const cleanName = name.replace(/\s/g, '');
      const displayName = cleanName.split('').join('  ');
      let nameSize = s(cleanName.length <= 3 ? 120 : cleanName.length <= 5 ? 95 : 75);
      
      // Measure and scale down if needed
      ctx.font = `900 ${nameSize}px 'Frank Ruhl Libre', serif`;
      let nameWidth = ctx.measureText(displayName).width;
      const maxNameWidth = width * 0.85;
      if (nameWidth > maxNameWidth) {
        nameSize = nameSize * (maxNameWidth / nameWidth);
      }
      
      drawText(displayName, currentY, nameSize, '#2b1810', '900');
      currentY += s(75);

      // Interpretation line - auto-scaled
      const interpLine = getInterpretationLine(name);
      let interpSize = s(32);
      ctx.font = `700 ${interpSize}px 'Frank Ruhl Libre', serif`;
      let interpWidth = ctx.measureText(interpLine).width;
      const maxInterpWidth = width * 0.9;
      if (interpWidth > maxInterpWidth) {
        interpSize = interpSize * (maxInterpWidth / interpWidth);
      }
      drawText(interpLine, currentY, interpSize, '#3d2b1f', '700');
      currentY += s(60);

      // Divider
      drawDivider(currentY, s(140));
      currentY += s(55);

      // Blessing text - multi-line
      const blessing = getSpiritualBlessing(name, gender);
      const blessingLines = blessing.split('\n');
      const blessingSize = s(24);
      ctx.font = `400 ${blessingSize}px 'Frank Ruhl Libre', serif`;

      blessingLines.forEach(line => {
        if (line.trim()) {
          drawText(line.trim(), currentY, blessingSize, '#2b1810', '400');
        }
        currentY += s(38);
      });

      currentY += s(25);

      // Bottom divider
      drawDivider(currentY, s(200));
      currentY += s(35);

      // Copyright
      drawText('×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ××™×œ ×‘××© | ×ª×¤×™×œ×” ××”×©×§×˜', currentY, s(16), 'rgba(140,106,66,0.6)', '700');
    };

    /* ===== DOWNLOAD FUNCTIONS ===== */
    const downloadImage = (name, gender, format) => {
      const canvas = document.getElementById('renderCanvas');
      let w, h, filename;
      
      if (format === 'phone') {
        w = 1170; h = 2532; // iPhone 14 Pro
        filename = `××’×™×œ×ª_${name}_×˜×œ×¤×•×Ÿ.png`;
      } else if (format === 'a4-single') {
        w = 2480; h = 3508; // A4 at 300dpi
        filename = `××’×™×œ×ª_${name}_A4.png`;
      } else {
        // a4-quad: render 4 on one A4
        w = 2480; h = 3508;
        filename = `××’×™×œ×ª_${name}_4×‘×“×£.png`;
      }

      if (format === 'a4-quad') {
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        // White background
        ctx.fillStyle = '#f5f0e8';
        ctx.fillRect(0, 0, w, h);

        // Render 4 cards
        const tempCanvas = document.createElement('canvas');
        const cardW = (w - 60) / 2;
        const cardH = (h - 60) / 2;
        renderScrollToCanvas(tempCanvas, name, gender, cardW, cardH);
        
        ctx.drawImage(tempCanvas, 20, 20, cardW, cardH);
        ctx.drawImage(tempCanvas, cardW + 40, 20, cardW, cardH);
        ctx.drawImage(tempCanvas, 20, cardH + 40, cardW, cardH);
        ctx.drawImage(tempCanvas, cardW + 40, cardH + 40, cardW, cardH);
      } else {
        renderScrollToCanvas(canvas, name, gender, w, h);
      }

      // Download
      const link = document.createElement('a');
      link.download = filename;
      link.href = canvas.toDataURL('image/png', 1.0);
      link.click();
    };

    /* ===== ICONS ===== */
    const Download = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
    const CheckCircle = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
    const FileText = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>;
    const LayoutGrid = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>;
    const Smartphone = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>;
    const ShieldCheck = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><polyline points="9 12 11 14 15 10"/></svg>;

    /* ===== MAIN PAGE ===== */
    const App = () => {
      // Read URL params
      const params = new URLSearchParams(window.location.search);
      const savedName = (() => { try { return localStorage.getItem('scroll_name') || ''; } catch(e) { return ''; } })();
      const savedGender = (() => { try { return localStorage.getItem('scroll_gender') || 'male'; } catch(e) { return 'male'; } })();
      const [name, setName] = useState(params.get('name') || savedName);
      const [gender, setGender] = useState(params.get('gender') || savedGender);
      const [downloading, setDownloading] = useState(null);
      const [fontsLoaded, setFontsLoaded] = useState(false);

      useEffect(() => {
        // Wait for fonts to load before enabling downloads
        document.fonts.ready.then(() => setFontsLoaded(true));
      }, []);

      const handleDownload = (format) => {
        setDownloading(format);
        // Small delay to ensure fonts are rendered
        setTimeout(() => {
          downloadImage(name, gender, format);
          setTimeout(() => setDownloading(null), 1000);
        }, 200);
      };

      return (
        <div className="min-h-screen bg-[#1a1a1a] text-white" style={{ direction: 'rtl' }}>
          {/* Header */}
          <header className="bg-black/50 backdrop-blur-2xl border-b border-white/10 px-6 py-4 flex justify-between items-center">
            <div className="flex flex-col">
              <h1 className="text-xl font-bold text-white hebrew-prayer">×¡×˜×•×“×™×• ×ª×¤×™×œ×” ××”×©×§×˜</h1>
              <span className="text-[9px] text-amber-400 font-bold uppercase tracking-widest flex items-center gap-1">
                <ShieldCheck size={10} /> OFFICIAL EYAL BASH STUDIO
              </span>
            </div>
            <div className="flex items-center gap-2 bg-green-600/20 border border-green-500/30 rounded-full px-4 py-2">
              <CheckCircle size={16} className="text-green-400" />
              <span className="text-green-400 text-xs font-bold hebrew-prayer">×”×ª×©×œ×•× ××•×©×¨ âœ“</span>
            </div>
          </header>

          {/* Main content */}
          <main className="max-w-4xl mx-auto px-6 py-12">
            {/* Success message */}
            <div className="text-center mb-12 animate-in">
              <div className="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6 glow">
                <CheckCircle size={40} className="text-green-400" />
              </div>
              <h2 className="text-3xl md:text-4xl font-black text-white mb-3 hebrew-prayer">
                ×”××’×™×œ×” ×©×œ×š ××•×›× ×”, {name}!
              </h2>
              <p className="text-amber-200/60 text-lg hebrew-prayer" style={{ fontWeight: 400 }}>
                ×ª×•×“×” ×¢×œ ×”×¨×›×™×©×”. ×”×§×‘×¦×™× ×©×œ×š ××•×›× ×™× ×œ×”×•×¨×“×” â€” ×œ×œ× ×¡×™××Ÿ ××™×.
              </p>
            </div>

            {/* Preview of what they get */}
            <div className="bg-white/5 rounded-3xl border border-white/10 p-8 mb-10 animate-in" style={{ animationDelay: '0.2s' }}>
              <div className="text-center mb-6">
                <div className="text-lg font-bold text-amber-400 hebrew-prayer mb-2">×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”××’×™×œ×”</div>
                <div className="text-amber-200/40 text-sm hebrew-prayer" style={{ fontWeight: 400 }}>
                  ×©×: <span className="text-white font-bold">{name}</span> | 
                  × ×™×¡×•×—: <span className="text-white font-bold">{gender === 'male' ? '×–×›×¨' : '× ×§×‘×”'}</span>
                </div>
              </div>
              
              {/* Scroll content preview (text only) */}
              <div className="bg-[#f5e6c8] rounded-2xl p-8 max-w-md mx-auto text-center" style={{ color: '#2b1810' }}>
                <div className="text-xs mb-3" style={{ color: '#8c6a42' }}>×‘××•×ª×™×•×ª ×©××š ×”×•×©× ×¡×™××Ÿ ××”×©×</div>
                <div className="text-4xl font-black mb-2 hebrew-prayer" style={{ letterSpacing: '8px' }}>
                  {name.replace(/\s/g,'').split('').join(' ')}
                </div>
                <div className="text-sm font-bold mb-4 hebrew-prayer" style={{ color: '#3d2b1f' }}>
                  {getInterpretationLine(name)}
                </div>
                <div className="text-xs leading-relaxed whitespace-pre-line" style={{ color: '#2b1810', fontWeight: 400 }}>
                  {getSpiritualBlessing(name, gender)}
                </div>
                <div className="text-[8px] mt-4" style={{ color: 'rgba(140,106,66,0.5)' }}>
                  ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª ×œ××™×œ ×‘××© | ×ª×¤×™×œ×” ××”×©×§×˜
                </div>
              </div>
            </div>

            {/* Download buttons */}
            <div className="grid grid-cols-1 md:grid-cols-3 gap-5 animate-in" style={{ animationDelay: '0.4s' }}>
              {/* A4 Single */}
              <button 
                onClick={() => handleDownload('a4-single')}
                disabled={!fontsLoaded || downloading === 'a4-single'}
                className="group bg-gradient-to-b from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white rounded-2xl p-6 flex flex-col items-center gap-4 transition-all active:scale-95 disabled:opacity-50 shadow-[0_10px_30px_rgba(217,119,6,0.3)]"
              >
                <div className="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center group-hover:bg-white/20 transition-all">
                  <FileText size={28} />
                </div>
                <div>
                  <div className="font-bold text-lg hebrew-prayer">A4 ××œ×</div>
                  <div className="text-amber-200/60 text-xs">×§×œ×£ ××—×“ ×¢×œ ×“×£ ×©×œ×</div>
                </div>
                <div className="bg-white/20 rounded-full px-5 py-2 flex items-center gap-2 text-sm font-bold">
                  <Download size={16} />
                  {downloading === 'a4-single' ? '××•×¨×™×“...' : '×”×•×¨×“ PNG'}
                </div>
              </button>

              {/* A4 Quad */}
              <button 
                onClick={() => handleDownload('a4-quad')}
                disabled={!fontsLoaded || downloading === 'a4-quad'}
                className="group bg-gradient-to-b from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white rounded-2xl p-6 flex flex-col items-center gap-4 transition-all active:scale-95 disabled:opacity-50 shadow-[0_10px_30px_rgba(217,119,6,0.3)]"
              >
                <div className="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center group-hover:bg-white/20 transition-all">
                  <LayoutGrid size={28} />
                </div>
                <div>
                  <div className="font-bold text-lg hebrew-prayer">4 ×‘×“×£ A4</div>
                  <div className="text-amber-200/60 text-xs">××¨×‘×¢×” ×§×œ×¤×™× ×œ×’×–×™×¨×”</div>
                </div>
                <div className="bg-white/20 rounded-full px-5 py-2 flex items-center gap-2 text-sm font-bold">
                  <Download size={16} />
                  {downloading === 'a4-quad' ? '××•×¨×™×“...' : '×”×•×¨×“ PNG'}
                </div>
              </button>

              {/* Phone Wallpaper */}
              <button 
                onClick={() => handleDownload('phone')}
                disabled={!fontsLoaded || downloading === 'phone'}
                className="group bg-gradient-to-b from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white rounded-2xl p-6 flex flex-col items-center gap-4 transition-all active:scale-95 disabled:opacity-50 shadow-[0_10px_30px_rgba(217,119,6,0.3)]"
              >
                <div className="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center group-hover:bg-white/20 transition-all">
                  <Smartphone size={28} />
                </div>
                <div>
                  <div className="font-bold text-lg hebrew-prayer">×©×•××¨ ××¡×š</div>
                  <div className="text-amber-200/60 text-xs">××•×ª×× ×œ××™×™×¤×•×Ÿ / ×× ×“×¨×•×™×“</div>
                </div>
                <div className="bg-white/20 rounded-full px-5 py-2 flex items-center gap-2 text-sm font-bold">
                  <Download size={16} />
                  {downloading === 'phone' ? '××•×¨×™×“...' : '×”×•×¨×“ PNG'}
                </div>
              </button>
            </div>

            {/* Instructions */}
            <div className="mt-10 bg-white/5 rounded-2xl border border-white/10 p-6 text-center animate-in" style={{ animationDelay: '0.6s' }}>
              <div className="text-amber-400 font-bold mb-3 hebrew-prayer">ğŸ’¡ ×˜×™×¤×™× ×œ×”×“×¤×¡×”</div>
              <div className="text-amber-200/50 text-sm leading-relaxed hebrew-prayer" style={{ fontWeight: 400 }}>
                ××•××œ×¥ ×œ×”×“×¤×™×¡ ×¢×œ × ×™×™×¨ ×¢×‘×” 250 ×’×¨× ×‘×’×•×•×Ÿ ×©×× ×ª ×œ××¨××” ×”××•×ª× ×˜×™ ×‘×™×•×ª×¨.<br/>
                ×œ×©×•××¨ ××¡×š â€” ×©××¨×• ××ª ×”×ª××•× ×” ×‘×’×œ×¨×™×” ×•×”×’×“×™×¨×• ×›×˜×¤×˜.
              </div>
            </div>

            {/* Font loading indicator */}
            {!fontsLoaded && (
              <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/80 text-amber-400 px-6 py-3 rounded-full text-sm font-bold hebrew-prayer border border-amber-500/20">
                â³ ×˜×•×¢×Ÿ ×¤×•× ×˜×™×...
              </div>
            )}
          </main>

          {/* Footer */}
          <footer className="bg-black/90 text-white py-10 px-6 text-center border-t border-white/5">
            <div className="text-[10px] opacity-40 uppercase tracking-[6px] font-bold leading-loose">
              Â© {new Date().getFullYear()} ××™×œ ×‘××© â€” ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª | ×ª×¤×™×œ×” ××”×©×§×˜
            </div>
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
